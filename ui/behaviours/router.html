<script>
    Polymer({

        is: "behaviour-router",

        properties:
        {
            page: String,
            active: String,
            inactive: String,
            hideClass: String,
            activeClass: String,
            activeDelay: {type: Boolean, value: false},
            inactiveDelay: {type: Boolean, value: false}

        },

        ready: function()
        {
            window.addEventListener("urlchange", this._toggle.bind(this), false)
        },

        attached: function()
        {
            this.parentNode.style.transition = 'none'
            this._toggle({detail: window.location.pathname})
            var offset = this.parentNode.offsetHeight // Trigger a reflow
            this.parentNode.style.transition = ''
        },

        _toggle: function(event)
        {
            var host = this.parentNode

            clearTimeout(this._timeOut)

            if (this._isSubRoute(this.page, event.detail))
            {
                host.classList.remove(this.hideClass)

                if (typeof this.active !== 'undefined')
                {
                    var transitionTime = 0

                    if (this.activeDelay)
                        transitionTime = parseFloat(getComputedStyle(host).transitionDuration)

                    this._timeOut = setTimeout(this._callActiveFunction.bind(this), transitionTime * 1000)
                }
            }

            else
            {
                host.classList.add(this.hideClass)

                if (typeof this.inactive !== 'undefined')
                {
                    var transitionTime = 0

                    if (this.inactiveDelay)
                        transitionTime = parseFloat(getComputedStyle(host).transitionDuration)

                    this._timeOut = setTimeout(this._callInactiveFunction.bind(this), transitionTime * 1000)
                }
            }
        },

        _callActiveFunction: function()
        {
            this.parentNode[this.active].call(this.parentNode)
        },

        _callInactiveFunction: function()
        {
            this.parentNode[this.inactive].call(this.parentNode)
        },

        _isSubRoute: function(childPath, parentPath)
        {
            return parentPath.match(new RegExp('^' + childPath + '$')) !== null
        }
    })
</script>
